services:
  traefik:
    image: traefik:v3.2.3
    container_name: traefik
    restart: unless-stopped

    # ğŸ”— Puertos expuestos
    ports:
      # Traefik (http)
      - "80:80"

      # Traefik (https)
      - "443:443"

    # ğŸ“‚ VolÃºmenes montados
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro # Acceso al socket de Docker
      - traefik-public-certificates:/certificates  # Certificados SSL/TLS
      - ./services/traefik/traefik.toml:/etc/traefik/traefik.toml:ro # ConfiguraciÃ³n principal
      - ./services/traefik/middlewares/middlewares.toml:/etc/traefik/middlewares.toml # Middlewares
      - ./services/traefik/auth/usersFile:/etc/traefik/usersFile # AutenticaciÃ³n bÃ¡sica

    # ğŸ·ï¸ Etiquetas para Traefik
    labels:
      traefik.enable: "true" # Habilita Traefik para este servicio

      # Router para el Dashboard de Traefik (HTTP)
      traefik.http.routers.traefik_dashboard_http-router.entrypoints: "http" # EntryPoint HTTP
      traefik.http.routers.traefik_dashboard_http-router.rule: "Host(`${TRAEFIK_DASHBOARD_DOMAIN}`)" # Regla basada en el dominio
      traefik.http.routers.traefik_dashboard_http-router.middlewares: "redirect-to-https@file" # Middleware para redirigir a HTTPS

      # Router para el Dashboard de Traefik (HTTPS)
      traefik.http.routers.traefik_dashboard_https-router.entrypoints: "https" # EntryPoint HTTPS
      traefik.http.routers.traefik_dashboard_https-router.rule: "Host(`${TRAEFIK_DASHBOARD_DOMAIN}`)" # Regla basada en el dominio
      traefik.http.routers.traefik_dashboard_https-router.service: "api@internal" # Servicio interno para el Dashboard
      traefik.http.routers.traefik_dashboard_https-router.tls: "true" # Habilita TLS
      traefik.http.routers.traefik_dashboard_https-router.tls.certresolver: "letsencrypt" # Certificados SSL/TLS
      traefik.http.routers.traefik_dashboard_https-router.middlewares: "auth-basic@file" # Middleware de autenticaciÃ³n bÃ¡sica

    # ğŸŒ Red asignada al servicio
    networks:
      - hic-cibus


# ğŸ“‚ VolÃºmenes
volumes:
  traefik-public-certificates:


# ğŸŒ Redes
networks:
  hic-cibus:
    external: true