services:
  traefik-dev:
    image: traefik:v3.2.3
    container_name: traefik-dev
    restart: unless-stopped

    # 🔗 Puertos expuestos
    ports:
      # Traefik Port (http)
      - "80:80"

      # PostgreSQL Ports - development mode
      - "5433:5433" # PostgreSQL (CRUD DB)
      - "5500:5500" # PostgreSQL (EMQX DB)

      # EMQX Ports
      - "1883:1883" # MQTT
      - "8083:8083" # Websocket

    # 📂 Volúmenes montados
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # Acceso al socket de Docker
      - ./services/traefik/traefik-dev.toml:/etc/traefik/traefik.toml # Archivo de configuración de Traefik

    # 🏷️ Etiquetas para Traefik
    labels:
      - "traefik.enable=true" # Habilita Traefik para este servicio

      # Configuración del Servicio Dashboard
      - "traefik.http.services.dashboard.loadbalancer.server.port=8080" # Puerto interno del servicio

      # Router para el Dashboard de Traefik (HTTP)
      - "traefik.http.routers.dashboard-http.rule=Host(`${TRAEFIK_DASHBOARD_DOMAIN_DEV}`)" # Regla basada en el dominio
      - "traefik.http.routers.dashboard-http.entrypoints=http" # EntryPoint HTTP
      - "traefik.http.routers.dashboard-http.service=api@internal" # Servicio interno asignado al router
      - "traefik.http.routers.dashboard-http.middlewares=auth-basic"
      - "traefik.http.middlewares.auth-basic.basicauth.users=${TRAEFIK_DASHBOARD_AUTH_USERS_DEV}"

    # 🌍 Red asignada al servicio
    networks:
      - hic-cibus


# 🌐 Redes utilizadas
networks:
  hic-cibus:
    external: true # Red externa definida previamente